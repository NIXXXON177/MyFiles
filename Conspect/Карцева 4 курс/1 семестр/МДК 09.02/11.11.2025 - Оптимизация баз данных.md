**Оптимизация баз данных** - это процесс повышения производительности системы, который включает анализ и настройку различных аспектов работы с базами данных.

**Цель** - более быстрая обработка данных, выполнение запросов за меньшее время и улучшение общего времени отклика системы.

Оптимизация может включать работу с проектированием базы данных, оптимизацию запросов, настройку параметров СУБД и обеспечение безопасности. 

Оптимизировать работу БД нужно, чтобы снизить операционные издержки и улучшить опыт пользователей. От оптимизации зависит быстродействие системы управления, устойчивость и безопасность хранимой информации, а также экономическая эффективность.

## Методы оптимизации баз данны: 
1. **Индексирование**. Индексы представляют собой структуры данных, которые обеспечивают механизм быстрого поиска, существенно улучшая производительность. Они работают путем создания структуры отсортированных данныз, что позволяет ядру базы данных быстро обнаруживать строки, удовлетворяющие предложению WHERE. Составные индексы включают несколько столбцов и полезны для запросов, которые фильтруют или сортируют данные по нескольким условиям. Это сокращает необходимость в отдельных индексах по каждому столбцу и улучшает эффективность планировщика запросов. 
2. **Нормализация и денормализация.** Нормализация - это процесс для минимизации избыточности и зависимостей в данных, уменьшающий вероятность аномалий данных. Посредством разбиения больших таблиц на меньше связанные таблицы нормализация гарантирует согласованность данных. Однако это может привести к написанию более сложных запросов. Денормализация вводит контролируемую избыточность для улучшения производительности запросов, особенно в тяжёлых операциях чтения. 
3. **Оптимизация запросов.** Регулярно анализируйте и оптимизируйте часто используемые запросы. Используйте инструменты типа EXPLAIN, чтобы понять план выполнения запроса и нахождения мест, которые можно улучшить. **Избегайте использования SELECT** Извлекайте только необходимые столбцы, а не выбирайте их все. Это уменьшает количество передаваемых данных и их обработку, улучшая производительность запроса.
4. **Секционирование** - деление больших таблиц на меньшие, более управляемые части. Это может значительно улучшить производительность запросов, позволяя ядру базы данных работать с более мелкими наборами данных, что ускоряет выполнение запроса
5. **Кэширование запроса.** Механизм кэширования применяют для сохранения результатов часто выполняемых запросов. Это уменьшает нагрузку на базу данных, предоставляя кэшированные результаты и сокращая время отклика. 
6. **Регулярное обслуживание.** Обновление статистики и архивирование данных 
7. **Оптимизация аппаратного обеспечения:** оптимизация конфигурации сервера (размер буферов, установки кэша, ограничения на число подключений) и использование ssd. 
8. **Управление параллелизмом: Уровни изоляции.** Настройте уровни изоляции в соответствии с требованиями вашего приложения. Уровни изоляции управляют видимостью изменений, выполненных одной транзакцией для других транзакций. Выбор подходящего уровня изоляции важен для соблюдения баланса между согласованностью и производительностью. 
9. **Использование пула подключений:** повторное использование подключений к базе данных, чтобы избежать накладных расходов, связанных с установкой новых подключений для каждого обращения. Пул подключений помогает эффективно управлять повторным использованием подключений к базе данных.
10. **Разработка эффективного проекта схемы:** проектируйте схему базы данных, держа в голове производительность. Оптимизируйте типы данных, используйте подходящие ограничения и минимизируйте необязательные связи. Хорошо спроектированная схема может оказать существенное влияние на эффективность запросов.
11. **Мониторинг и профилирование: Регулярный мониторинг.** Используйте инструменты мониторинга для отслеживания производительности базы данных во времени. Регулярно отслеживайте ключевые метрики, такие как использование ЦП, использование памяти и время выполнения запросов, для обнаружения потенциальных проблем. **Профилирование запросов** - профилируйте и анализируйте производительность отдельных запросов для выявления узких мест. Инструменты типа MySQL Performance Schema могут обеспечить подробные сведения о выполнении запроса.

```sql
CREATE TABLE sales (
sale_id INT PRIMARY KEY,
sale_date DATE,
amount DECIMAL(10,2)
) PARTITION BY RANGE (YEAR(sale_date)) (
PARTITION p0 VALUES LESS THAN (1990);
PARTITION p1 VALUES LESS THAN (2000);
PARTITION p2 VALUES LESS THAN (2010);
PARTITION p3 VALUES LESS THAN (2020);
PARTITION p4 VALUES LESS THAN (MAXVALUE);
);
```

```python
from django.core.cache import chache
def get_user_data(user_id):
	# Пытаемся получить данные из кэша
	user_data = cache.get(f'user_{user_id}')
	if user_data is None:
		# Если в кэше нет, получаем из базы данных
		user_data = User.objects,get(id=user_id)
		# Сохраняем данные в кэше для последующих обращений
		cache.set(f'user_{user_id}', user_data, TIMEOUT)
	return user_data
```

## Оптимизация SQL запросов
**Анализ и диагностика производительности запросов**
Прежде чем приступать к оптимизации, важно понять, какие запросы вызывают проблемы и почему. Для этого можно использовать различные инструменты и техники:
1) Команда ==EXPLAIN== в SQL позволяет увидеть, как база данных планирует выполнить запрос. Она показывает, какие индексы будут использоваться, сколько строк будет прочитано и другие важные детали. Это даёт представление о том, как база данных интерпретирует запрос и какие шаги предпринимает для его выполнения. Использование  EXPLAIN помогает выявить узкие места в запросах и понять, какие части запроса требуют оптимизации. 
```sql
EXPLAIN SELECT * FROM users WHERE age > 30;
```
2) **Мониторинг производительности** (выявляем медленные запросы, позволяет понять нагрузку на систему)
3) **Логирование медленных запросов** (позволяет увидеть что замедляет выполнение запросов)