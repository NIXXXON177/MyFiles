# Клиент? Сервер?

В сообществе ускорения сайтов принято разделение на клиентскую и серверную оптимизацию. Такое разделение немного условное.
	- серверная оптимизация - действия по ускорению формирования HTML-документа (самой страницы) и сокращению задержек, вносимых сервером.
	- клиентская оптимизация - ускорение всех остальных компонентов страницы: CSS-кода, JS-кода, картинок, подключаемых шрифтов, видео и т.д. По сути, это оптимизация всего, что отображается в браузере (клиенте).

# Серверная оптимизация

Компоненты, формирующие задержки:

1. **КОД САЙТА**

Для оптимизации нужно выделить, потребляющий значительное время. Иногда это может быть сторонний модуль (плагин), тогда нужно поискать ему замену или обратиться к разработчику.

Найти наиболее тормозящий участок помогает ==профилирование программного кода==. Для каждого языка программирования существует свои средства. В результате профилирования можно найти участок кода, отвечающий за большую часть времени выполнения (если такой участок вообще есть).

За счет внесения изменений в код можно получить качественное ускорение (в 10-100 раз), однако это довольно затратный процесс. Помимо честного ускорения кода можно применить ==серверное кэширование страниц или компонентов==. Такой подход позволит замаскировать проблему медленного кода для посещаемых страниц, однако медленные страницы все равно будут регулярно вылезать (когда отсутствует кэш).

2. **СУДБ, SQL-ЗАПРОСЫ**

Основная причина торможения - ==время обработки SQL-запросов к БД.==

Для выявления медленных запросов существуют специальные средства сбора статистики (для MySQL это slow query log)

Вторая причина - это ==оптимизация настроек СУБД==, то есть сервера баз данных. Каждая СУБД имеет сотни настроек, многие из которых влияют на скорость работы. Проведение тюнинга этих настроек может дать дополнительный прирост скорости.

3. **ОПЕРАЦИОННАЯ СИСТЕМА**

В целом, ОС (обычно линукс) не должна вносить проблем в работу веб-приложения. Однако, для тонкой оптимизации (особенно в случаях высоких нагрузок) может понадобится тюнинг низкоуровневых системных настроек.

Также не стоит забывать, что современный системный софт часто дает преимущества в скорости и возможностях. Например, ядро Линукс постоянно совершенствуется, внедряются сетевые оптимизации и поддержка новых инструкций процессоров.

4. **АППАРАТНОЕ ОБЕСПЕЧЕНИЕ, СЕТЬ**

Для большинства сайтов выбор аппаратной конфигурации и сетевых параметров определяется хостингом. Однако, если проект использует собственное оборудование, есть пространство для маневра. Например, можно ==оценить потребности проекта в ресурсах== (CPU, память, дисковая подсистема) и ==подобрать подходящий сервер.==

==Сетевые ресурсы==, как правило, ==измеряются в пропускной способности канала==. Стандартные значения сегодня это 100 Мбит и 1 Гбит в секунду. Если структуру сайта включает в себя раздачу тяжелого контента (видео), стоит задуматься об увеличении канала.

С точки зрения сети также нужно ==учитывать сетевые задержки и размещать сайт как можно ближе к посетителям==. В случае глобальной аудитории (несколько стран) стоит ==задуматься об использовании CDN== (content delivery network). 

# Клиентская оптимизация

Компоненты, формирующие задержки и способы их оптимизации:

1. **CSS-код**

Основные пути ускорения:
	- отключение неиспользуемого кода.
	- сжатие эффективными алгоритмами (brotli, zopfli). Хранить заранее сжатую версию для быстрой отдачи.
	- минификация кода (сокращение лишних пробелов, избыточных директив и т.д.).
	- сокращение количества отдельных ресурсов (запросов), вплоть до встраивания в HTML.
	- размещение на том же домене, что и HTML-документ (для использования существующего TCP-соединения).
	- кэширование на стороне клиента (заголовок cache-control).


2. **JS-код**

Основные пути ускорения:
	- отключение неиспользуемого кода.
	- перенос кода из блокирующего режиме в асинхронный (defer, async атрибуты).
	- поиск и устранение дубликатов кода.
	- обновление версий js-библиотек.
	- сжатие эффективными алгоритмами (brotli, zopfli). Хранить заранее сжатую версию для быстрой отдачи.
	- минификация кода (сокращение лишних пробелов, избыточных директив и т.д.).
	- сокращение количества отдельных ресурсов (запросов), вплоть до встраивания в HTML.
	- разбиение на блоки до 50 кб, для постепенного исполнения в браузере.
	- точечная оптимизация кода по результатам профилирования в браузере.
	- размещение на том же домене, что и HTML-документ (для использования существующего TCP-соединения).
	- кэширование на стороне клиента (заголовок cache-control).

3. Изображения

Картинки не блокируют рендеринг страницы, но занимают большую часть (в среднем 80%) "веса" (трафика)

Основная задача при оптимизации - сократить их размер в байтах  и сохранить качество.

Методы оптимизации:
	- использование более эффективных форматов. Везде, где допустимо использование сжатие с потерями (JPEG), для современных браузеров использовать продвинутые форматы (WebP для Chrome).
	- внедрение векторной графики и вынос текста из картинок. Для векторных изображений можно использовать формат SVG.
	- оптимизация сжатия за счет продвинутых инструментов: mozJPEG, zopfliPNG, optiPNG и других.
	- изменение размеров в пикселях для точного соответствия, создание миниатюр вместо масштабирования средствами браузера.
	- удаление метаданных из файлов (EXIF, цветовые профили и т.д.)

4. **Шрифты**

Методы оптимизации:
	- сокращение количества вариантов и гарнитур шрифтов. Загружать нужно только те варианты, которые реально используются на сайте: жирность, курсив, другие эффекты.
	- загрузка ограниченного набора символов.
	- использование нового формата с лучшим сжатием - WOFF2 (для совместимости можно сделать еще WOFF).
	- если шрифт важен для отображения основного текста, объявить его файл как  можно раньше, сделать preload для него в секции head.
	- установить неблокирующий режим font-display: fallback для шрифтов.
	- кэширование на стороне клиента (заголовок cache-control).

**Вывод**

При построении высокопроизводительных веб-приложений должен присутствовать и клиентский, и серверный подход. В этом случае можно говорить о пересекающейся области ответственности, но никак не о превалировании одной логики над другой.

Когда дело доходит до взаимодействия "клиент-сервер", нужно помнить обо всех аспектах. оптимизации. И у клиентской составляющей есть своя, выделенная область ответственности. Она находится в окне браузера - это веб-страница, которая загружается у пользователя и с которой он взаимодействует.
