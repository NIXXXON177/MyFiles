<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ—Ç–∞–ª–∏ –∫—É—Ä—Å–∞ | –¢–µ—Ö–Ω–æ–õ–∞–π–Ω</title>
    <link rel="stylesheet" href="../style/style.css">
    <link rel="icon" href="../img/MainLogo.svg" type="image/svg+xml">
</head>
<body>
    <div id="app">
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <a href="../index.html"><img src="../img/MainLogo.svg" alt="Logo" class="logo-img">
                    <span class="logo-text">–¢–µ—Ö–Ω–æ–õ–∞–π–Ω</span></a>
                    
                </div>
                <div class="nav-menu" id="navMenu">
                    <a href="../index.html" class="nav-link">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
                    <a href="courses.html" class="nav-link">–ú–æ–∏ –∫—É—Ä—Å—ã</a>
                    <a href="#" class="nav-link">–ü–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è</a>
                    <div class="user-section">
                        <span class="user-name" id="userName">–ü–µ—Ç—Ä–æ–≤ –ê.–í.</span>
                        <button class="btn-logout" id="logoutBtn">–í—ã–π—Ç–∏</button>
                    </div>
                </div>
                <button class="nav-toggle" id="navToggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </nav>

        <main class="main-content">
            <div class="container">
                <a href="courses.html" class="btn-link" style="display: inline-flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                    ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –∫—É—Ä—Å–æ–≤
                </a>
                
                <div id="courseDetails">
                    <!-- –î–µ—Ç–∞–ª–∏ –∫—É—Ä—Å–∞ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    <div class="card text-center">
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫—É—Ä—Å–µ...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="../scripts/auth.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    if (!AuthManager.checkAuth()) {
        window.location.href = 'login.html';
        return;
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const userData = AuthManager.getUserData();
    if (userData && userData.employee) {
        const userNameElement = document.getElementById('userName');
        if (userNameElement) {
            userNameElement.textContent = userData.employee.name.split(' ')[0] + ' ' + userData.employee.name.split(' ')[1];
        }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ç–∞–ª–µ–π –∫—É—Ä—Å–∞
    loadCourseDetails();
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã—Ö–æ–¥–∞
    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('authToken');
            localStorage.removeItem('userData');
            window.location.href = 'login.html';
        });
    }
    
    // –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
    const navToggle = document.getElementById('navToggle');
    const navMenu = document.getElementById('navMenu');
    
    if (navToggle && navMenu) {
        navToggle.addEventListener('click', () => {
            navMenu.classList.toggle('active');
        });
    }
});

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–ª–µ–µ—Ä–∞
let currentCourse = null;
let currentModuleIndex = 0;

function loadCourseDetails() {
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get('id');
    const container = document.getElementById('courseDetails');
    
    if (!courseId) {
        showCourseNotFound(container, '–ù–µ–≤–µ—Ä–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫—É—Ä—Å–∞');
        return;
    }
    
    const userData = AuthManager.getUserData();
    currentCourse = userData?.courses?.find(c => c.id == courseId);
    
    if (!currentCourse) {
        showCourseNotFound(container, '–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–π –∫—É—Ä—Å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –∫ –Ω–µ–º—É –¥–æ—Å—Ç—É–ø–∞');
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä mode –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–ª–µ–µ—Ä–∞
    const mode = urlParams.get('mode');
    if (mode === 'study') {
        renderCoursePlayer(container);
    } else {
        renderCourseDetails(container, currentCourse);
    }
}

function showCourseNotFound(container, message) {
    while (container.firstChild) {
        container.removeChild(container.firstChild);
    }

    const card = document.createElement('div');
    card.className = 'card text-center';
    
    const title = document.createElement('h2');
    title.textContent = '–ö—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω';
    
    const text = document.createElement('p');
    text.textContent = message;
    
    card.appendChild(title);
    card.appendChild(text);
    container.appendChild(card);
}

function renderCourseDetails(container, course) {
    while (container.firstChild) {
        container.removeChild(container.firstChild);
    }

    const card = document.createElement('div');
    card.className = 'card';

    const header = createCourseHeader(course);
    const content = createCourseContent(course);
    const actions = createCourseActions(course);

    card.appendChild(header);
    card.appendChild(content);
    card.appendChild(actions);
    container.appendChild(card);
}

function createCourseHeader(course) {
    const header = document.createElement('div');
    header.className = 'card-header';

    const title = document.createElement('h1');
    title.className = 'card-title';
    title.style.fontSize = '1.5rem';
    title.textContent = course.title;

    const status = document.createElement('div');
    status.className = `course-status ${getStatusClass(course.status)}`;
    status.textContent = getStatusText(course.status);

    header.appendChild(title);
    header.appendChild(status);
    return header;
}

function createCourseContent(course) {
    const content = document.createElement('div');
    content.className = 'course-content';

    const infoGrid = createCourseInfoGrid(course);
    const description = createCourseDescription(course);
    const modules = createCourseModulesPreview(course);
    const materials = createCourseMaterials(course);

    content.appendChild(infoGrid);
    content.appendChild(description);
    content.appendChild(modules);
    content.appendChild(materials);
    return content;
}

function createCourseInfoGrid(course) {
    const grid = document.createElement('div');
    grid.style.cssText = 'display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;';

    const items = [
        { title: '–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞', value: formatDate(course.start_date) },
        { title: '–°—Ä–æ–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è', value: formatDate(course.due_date) },
        { title: '–ü—Ä–æ–≥—Ä–µ—Å—Å', value: createProgressElement(course.progress) },
        { title: '–°—Ç–∞—Ç—É—Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞', value: getCertificateStatus(course) }
    ];

    items.forEach(item => {
        const infoItem = document.createElement('div');
        infoItem.className = 'info-item';

        const title = document.createElement('h3');
        title.textContent = item.title;

        infoItem.appendChild(title);

        if (typeof item.value === 'string') {
            const value = document.createElement('p');
            value.textContent = item.value;
            infoItem.appendChild(value);
        } else {
            infoItem.appendChild(item.value);
        }

        grid.appendChild(infoItem);
    });

    return grid;
}

function createProgressElement(progress) {
    const container = document.createElement('div');
    container.className = 'progress-container';

    const progressBar = document.createElement('div');
    progressBar.className = 'progress-bar';

    const progressFill = document.createElement('div');
    progressFill.className = 'progress-fill';
    progressFill.style.width = `${progress}%`;

    const progressLabel = document.createElement('div');
    progressLabel.className = 'progress-label';
    
    const span = document.createElement('span');
    span.textContent = `${progress}% –∑–∞–≤–µ—Ä—à–µ–Ω–æ`;
    progressLabel.appendChild(span);

    progressBar.appendChild(progressFill);
    container.appendChild(progressBar);
    container.appendChild(progressLabel);

    return container;
}

function createCourseDescription(course) {
    const container = document.createElement('div');
    container.className = 'course-description';
    container.style.marginBottom = '2rem';

    const title = document.createElement('h3');
    title.textContent = '–û–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞';

    const description = document.createElement('p');
    description.textContent = course.description || '–û–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.';

    container.appendChild(title);
    container.appendChild(description);
    return container;
}

function createCourseModulesPreview(course) {
    const container = document.createElement('div');
    container.className = 'course-modules-preview';
    container.style.marginBottom = '2rem';

    const title = document.createElement('h3');
    title.textContent = '–ú–æ–¥—É–ª–∏ –∫—É—Ä—Å–∞';
    title.style.marginBottom = '1rem';

    const modulesList = document.createElement('div');
    modulesList.className = 'modules-preview-list';

    if (course.modules && course.modules.length > 0) {
        const completedCount = course.modules.filter(m => m.completed).length;
        
        const summary = document.createElement('div');
        summary.className = 'modules-summary';
        summary.style.marginBottom = '1rem';
        summary.textContent = `–ü—Ä–æ–π–¥–µ–Ω–æ –º–æ–¥—É–ª–µ–π: ${completedCount}/${course.modules.length}`;

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 3 –º–æ–¥—É–ª—è –¥–ª—è –ø—Ä–µ–≤—å—é
        const previewModules = course.modules.slice(0, 3);
        
        previewModules.forEach((module, index) => {
            const moduleItem = createModulePreviewItem(module, index);
            modulesList.appendChild(moduleItem);
        });

        // –ï—Å–ª–∏ –º–æ–¥—É–ª–µ–π –±–æ–ª—å—à–µ 3, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ"
        if (course.modules.length > 3) {
            const showAllBtn = document.createElement('button');
            showAllBtn.className = 'btn btn-secondary';
            showAllBtn.textContent = `–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ ${course.modules.length} –º–æ–¥—É–ª–µ–π`;
            showAllBtn.style.marginTop = '1rem';
            showAllBtn.addEventListener('click', () => {
                switchToStudyMode();
            });
            modulesList.appendChild(showAllBtn);
        }

        container.appendChild(title);
        container.appendChild(summary);
        container.appendChild(modulesList);
    } else {
        const noModules = document.createElement('p');
        noModules.textContent = '–ú–æ–¥—É–ª–∏ –∫—É—Ä—Å–∞ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.';
        noModules.style.color = 'var(--text-muted)';
        
        container.appendChild(title);
        container.appendChild(noModules);
    }

    return container;
}

function createModulePreviewItem(module, index) {
    const item = document.createElement('div');
    item.className = `module-preview-item ${module.completed ? 'completed' : ''}`;
    item.style.cssText = 'display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 0.5rem;';

    const icon = document.createElement('span');
    icon.style.fontSize = '1.2rem';
    icon.textContent = module.completed ? '‚úÖ' : (module.type === 'video' ? 'üé•' : 'üìñ');

    const content = document.createElement('div');
    content.style.flex = '1';

    const moduleTitle = document.createElement('div');
    moduleTitle.style.fontWeight = '600';
    moduleTitle.style.color = 'var(--text-light)';
    moduleTitle.textContent = module.title;

    const moduleMeta = document.createElement('div');
    moduleMeta.style.fontSize = '0.9rem';
    moduleMeta.style.color = 'var(--text-muted)';
    moduleMeta.textContent = `${module.type === 'video' ? '–í–∏–¥–µ–æ' : '–¢–µ–∫—Å—Ç'} ‚Ä¢ ${module.duration} ${module.completed ? '‚Ä¢ –ü—Ä–æ–π–¥–µ–Ω–æ' : ''}`;

    content.appendChild(moduleTitle);
    content.appendChild(moduleMeta);
    item.appendChild(icon);
    item.appendChild(content);

    return item;
}

function createCourseMaterials(course) {
    const container = document.createElement('div');
    container.className = 'course-materials';

    const title = document.createElement('h3');
    title.className = 'materials-title';
    title.textContent = '–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∫—É—Ä—Å–∞';

    const materialsList = document.createElement('div');
    materialsList.className = 'materials-list';

    const mockMaterials = [
        { type: 'pdf', title: '–£—á–µ–±–Ω–æ–µ –ø–æ—Å–æ–±–∏–µ –ø–æ IT-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏', url: '#' },
        { type: 'video', title: '–í–≤–æ–¥–Ω–æ–µ –≤–∏–¥–µ–æ –∫ –∫—É—Ä—Å—É', url: '#' },
        { type: 'link', title: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è', url: '#' }
    ];

    mockMaterials.forEach(material => {
        const materialItem = createMaterialItem(material);
        materialsList.appendChild(materialItem);
    });

    container.appendChild(title);
    container.appendChild(materialsList);
    return container;
}

function createMaterialItem(material) {
    const item = document.createElement('div');
    item.className = 'material-item';

    const icon = document.createElement('div');
    icon.className = `material-icon ${material.type}`;
    icon.textContent = material.type === 'pdf' ? 'üìÑ' : 
                      material.type === 'video' ? 'üé•' : 'üîó';

    const content = document.createElement('div');
    content.className = 'material-content';

    const itemTitle = document.createElement('div');
    itemTitle.className = 'material-title';
    itemTitle.textContent = material.title;

    const itemType = document.createElement('div');
    itemType.className = 'material-type';
    itemType.textContent = material.type === 'pdf' ? 'PDF –¥–æ–∫—É–º–µ–Ω—Ç' : 
                          material.type === 'video' ? '–í–∏–¥–µ–æ –º–∞—Ç–µ—Ä–∏–∞–ª' : '–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ—Å—É—Ä—Å';

    const button = document.createElement('a');
    button.href = material.url;
    button.className = `material-btn ${material.type}`;
    button.target = '_blank';
    button.textContent = material.type === 'pdf' ? '–°–∫–∞—á–∞—Ç—å' : 
                        material.type === 'video' ? '–°–º–æ—Ç—Ä–µ—Ç—å' : '–ü–µ—Ä–µ–π—Ç–∏';

    content.appendChild(itemTitle);
    content.appendChild(itemType);
    item.appendChild(icon);
    item.appendChild(content);
    item.appendChild(button);

    return item;
}

function createCourseActions(course) {
    const actions = document.createElement('div');
    actions.className = 'course-actions';
    actions.style.marginTop = '2rem';
    actions.style.paddingTop = '2rem';
    actions.style.borderTop = '1px solid var(--glass-border)';
    actions.style.display = 'flex';
    actions.style.gap = '1rem';
    actions.style.flexWrap = 'wrap';

    const startBtn = document.createElement('button');
    startBtn.className = 'btn btn-primary';
    startBtn.style.padding = '1rem 2rem';
    startBtn.style.fontSize = '1.1rem';
    
    if (course.status === '–ø—Ä–æ–π–¥–µ–Ω') {
        startBtn.textContent = '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∫—É—Ä—Å';
    } else if (course.status === '–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ') {
        startBtn.textContent = '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ';
    } else {
        startBtn.textContent = '–ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ';
    }

    startBtn.addEventListener('click', switchToStudyMode);

    // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
    const viewModulesBtn = document.createElement('button');
    viewModulesBtn.className = 'btn btn-secondary';
    viewModulesBtn.textContent = '–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–æ–¥—É–ª–∏';
    viewModulesBtn.addEventListener('click', switchToStudyMode);

    actions.appendChild(startBtn);
    
    if (course.modules && course.modules.length > 0) {
        actions.appendChild(viewModulesBtn);
    }

    return actions;
}

function switchToStudyMode() {
    // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä mode=study –∫ —Ç–µ–∫—É—â–µ–º—É URL
    const currentUrl = new URL(window.location.href);
    currentUrl.searchParams.set('mode', 'study');
    window.history.pushState({}, '', currentUrl);
    
    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const container = document.getElementById('courseDetails');
    renderCoursePlayer(container);
}

function renderCoursePlayer(container) {
    while (container.firstChild) {
        container.removeChild(container.firstChild);
    }

    if (!currentCourse) {
        showCourseNotFound(container, '–ö—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }

    const playerCard = document.createElement('div');
    playerCard.className = 'card';

    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫–Ω–æ–ø–∫–æ–π –Ω–∞–∑–∞–¥
    const header = document.createElement('div');
    header.className = 'card-header';
    header.style.marginBottom = '2rem';

    const backBtn = document.createElement('button');
    backBtn.className = 'btn btn-secondary';
    backBtn.innerHTML = '‚Üê –ù–∞–∑–∞–¥ –∫ –æ–ø–∏—Å–∞–Ω–∏—é';
    backBtn.addEventListener('click', () => {
        // –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä mode –∏–∑ URL
        const currentUrl = new URL(window.location.href);
        currentUrl.searchParams.delete('mode');
        window.history.pushState({}, '', currentUrl);
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –æ–±—ã—á–Ω–æ–º—É –≤–∏–¥—É
        renderCourseDetails(container, currentCourse);
    });

    const title = document.createElement('h1');
    title.className = 'card-title';
    title.textContent = `–û–±—É—á–µ–Ω–∏–µ: ${currentCourse.title}`;

    header.appendChild(backBtn);
    header.appendChild(title);
    playerCard.appendChild(header);

    // –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø–ª–µ–µ—Ä–∞
    const playerContent = document.createElement('div');
    playerContent.className = 'course-player-content';
    playerContent.style.display = 'grid';
    playerContent.style.gridTemplateColumns = '300px 1fr';
    playerContent.style.gap = '2rem';
    playerContent.style.minHeight = '500px';

    const sidebar = createPlayerSidebar();
    const contentArea = createPlayerContentArea();

    playerContent.appendChild(sidebar);
    playerContent.appendChild(contentArea);
    playerCard.appendChild(playerContent);

    container.appendChild(playerCard);

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—ã–π –º–æ–¥—É–ª—å
    loadPlayerModule(currentModuleIndex);
}

function createPlayerSidebar() {
    const sidebar = document.createElement('div');
    sidebar.className = 'player-sidebar';
    sidebar.style.background = 'var(--glass-bg)';
    sidebar.style.backdropFilter = 'blur(25px)';
    sidebar.style.border = '1px solid var(--glass-border)';
    sidebar.style.borderRadius = 'var(--radius)';
    sidebar.style.padding = '1.5rem';
    sidebar.style.height = 'fit-content';
    sidebar.style.position = 'sticky';
    sidebar.style.top = '2rem';

    const modulesTitle = document.createElement('h3');
    modulesTitle.textContent = '–ú–æ–¥—É–ª–∏ –∫—É—Ä—Å–∞';
    modulesTitle.style.marginBottom = '1rem';
    modulesTitle.style.color = 'var(--text-light)';

    const modulesList = document.createElement('div');
    modulesList.className = 'player-modules-list';

    currentCourse.modules.forEach((module, index) => {
        const moduleItem = createPlayerModuleItem(module, index);
        modulesList.appendChild(moduleItem);
    });

    const progressSection = createPlayerProgressSection();

    sidebar.appendChild(modulesTitle);
    sidebar.appendChild(modulesList);
    sidebar.appendChild(progressSection);

    return sidebar;
}

function createPlayerModuleItem(module, index) {
    const item = document.createElement('div');
    item.className = `player-module-item ${module.completed ? 'completed' : ''} ${index === currentModuleIndex ? 'active' : ''}`;
    item.style.cssText = 'display: flex; align-items: flex-start; gap: 1rem; padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; cursor: pointer; transition: all 0.3s ease; border: 1px solid transparent;';
    
    item.addEventListener('click', () => {
        loadPlayerModule(index);
    });

    const icon = document.createElement('span');
    icon.style.cssText = 'width: 24px; height: 24px; border-radius: 50%; background: var(--glass-bg); display: flex; align-items: center; justify-content: center; font-size: 0.8rem; flex-shrink: 0;';
    icon.textContent = module.completed ? '‚úì' : (module.type === 'video' ? 'üé•' : 'üìñ');

    if (module.completed) {
        icon.style.background = 'rgba(76, 175, 80, 0.2)';
        icon.style.color = '#4caf50';
    }

    const content = document.createElement('div');
    content.style.flex = '1';

    const title = document.createElement('div');
    title.style.cssText = 'color: var(--text-light); font-weight: 500; font-size: 0.95rem; margin-bottom: 0.25rem; line-height: 1.3;';
    title.textContent = module.title;

    const meta = document.createElement('div');
    meta.style.cssText = 'color: var(--text-muted); font-size: 0.8rem;';
    meta.textContent = `${module.type === 'video' ? '–í–∏–¥–µ–æ' : '–¢–µ–∫—Å—Ç'} ‚Ä¢ ${module.duration}`;

    content.appendChild(title);
    content.appendChild(meta);
    item.appendChild(icon);
    item.appendChild(content);

    return item;
}

function createPlayerProgressSection() {
    const section = document.createElement('div');
    section.style.paddingTop = '1rem';
    section.style.borderTop = '1px solid var(--glass-border)';
    section.style.marginTop = '1rem';

    const completedModules = currentCourse.modules.filter(m => m.completed).length;
    const totalModules = currentCourse.modules.length;

    const progressText = document.createElement('div');
    progressText.style.cssText = 'color: var(--text-light); font-weight: 500; margin-bottom: 0.5rem;';
    progressText.textContent = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${completedModules}/${totalModules}`;

    const progressBar = document.createElement('div');
    progressBar.style.cssText = 'height: 8px; background: var(--glass-bg); border-radius: 4px; overflow: hidden; margin-bottom: 1rem;';

    const progressFill = document.createElement('div');
    progressFill.style.cssText = 'height: 100%; background: var(--gradient); border-radius: 4px; transition: width 0.3s ease;';
    progressFill.style.width = `${(completedModules / totalModules) * 100}%`;

    progressBar.appendChild(progressFill);
    section.appendChild(progressText);
    section.appendChild(progressBar);

    return section;
}

function createPlayerContentArea() {
    const content = document.createElement('div');
    content.className = 'player-content-area';

    const navigation = document.createElement('div');
    navigation.style.cssText = 'display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid var(--glass-border);';

    const prevBtn = document.createElement('button');
    prevBtn.className = 'btn btn-secondary';
    prevBtn.innerHTML = '‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π';
    prevBtn.addEventListener('click', () => {
        loadPlayerModule(currentModuleIndex - 1);
    });

    const nextBtn = document.createElement('button');
    nextBtn.className = 'btn btn-primary';
    nextBtn.innerHTML = '–°–ª–µ–¥—É—é—â–∏–π ‚Üí';
    nextBtn.addEventListener('click', () => {
        loadPlayerModule(currentModuleIndex + 1);
    });

    navigation.appendChild(prevBtn);
    navigation.appendChild(nextBtn);

    const moduleContent = document.createElement('div');
    moduleContent.id = 'playerModuleContent';

    content.appendChild(navigation);
    content.appendChild(moduleContent);

    return content;
}

function loadPlayerModule(moduleIndex) {
    if (moduleIndex < 0 || moduleIndex >= currentCourse.modules.length) {
        return;
    }

    currentModuleIndex = moduleIndex;
    const module = currentCourse.modules[moduleIndex];
    const contentArea = document.getElementById('playerModuleContent');

    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
    while (contentArea.firstChild) {
        contentArea.removeChild(contentArea.firstChild);
    }

    // –°–æ–∑–¥–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥—É–ª—è
    const moduleHeader = document.createElement('div');
    moduleHeader.style.marginBottom = '2rem';

    const title = document.createElement('h2');
    title.style.cssText = 'color: var(--text-light); font-size: 1.8rem; font-weight: 600; margin-bottom: 0.5rem;';
    title.textContent = module.title;

    const meta = document.createElement('div');
    meta.style.cssText = 'color: var(--text-muted); font-size: 1rem;';
    meta.textContent = `${module.type === 'video' ? '–í–∏–¥–µ–æ' : '–¢–µ–∫—Å—Ç'} ‚Ä¢ ${module.duration} ‚Ä¢ ${module.completed ? '–ü—Ä–æ–π–¥–µ–Ω–æ' : '–ù–µ –ø—Ä–æ–π–¥–µ–Ω–æ'}`;

    moduleHeader.appendChild(title);
    moduleHeader.appendChild(meta);
    contentArea.appendChild(moduleHeader);

    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –º–æ–¥—É–ª—è
    const content = document.createElement('div');
    content.style.lineHeight = '1.7';

    if (module.type === 'video') {
        const videoPlaceholder = document.createElement('div');
        videoPlaceholder.style.marginBottom = '2rem';
        videoPlaceholder.innerHTML = `
            <div style="background: rgba(0,0,0,0.3); border-radius: 8px; overflow: hidden; border: 1px solid var(--glass-border);">
                <div style="position: relative; height: 300px; background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%); display: flex; align-items: center; justify-content: center; cursor: pointer;">
                    <div style="width: 80px; height: 80px; background: rgba(255,255,255,0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: var(--primary); transition: all 0.3s ease;">‚ñ∂</div>
                </div>
                <div style="padding: 1rem; color: var(--text-light);">
                    <p>–í–∏–¥–µ–æ –º–∞—Ç–µ—Ä–∏–∞–ª: ${module.title}</p>
                    <p>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${module.duration}</p>
                </div>
            </div>
        `;
        content.appendChild(videoPlaceholder);
    }

    const textContent = document.createElement('div');
    textContent.style.cssText = 'background: rgba(255,255,255,0.05); padding: 2rem; border-radius: 8px; border: 1px solid var(--glass-border); margin-bottom: 2rem; color: var(--text-light); line-height: 1.7; white-space: pre-line;';
    textContent.textContent = module.content;
    content.appendChild(textContent);

    // –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–æ–¥—É–ª—è
    if (!module.completed) {
        const completeBtn = document.createElement('button');
        completeBtn.className = 'btn btn-primary';
        completeBtn.textContent = '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–µ';
        completeBtn.addEventListener('click', () => {
            completePlayerModule(moduleIndex);
        });
        content.appendChild(completeBtn);
    }

    contentArea.appendChild(content);

    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –º–æ–¥—É–ª—å –≤ —Å–∞–π–¥–±–∞—Ä–µ
    updatePlayerActiveModule();
}

function completePlayerModule(moduleIndex) {
    currentCourse.modules[moduleIndex].completed = true;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ localStorage
    const userData = JSON.parse(localStorage.getItem('userData'));
    const courseIndex = userData.courses.findIndex(c => c.id === currentCourse.id);
    userData.courses[courseIndex] = currentCourse;
    localStorage.setItem('userData', JSON.stringify(userData));

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    if (typeof NotificationManager !== 'undefined') {
        NotificationManager.showTempNotification('–ú–æ–¥—É–ª—å —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω!', 'info');
    }

    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –ø–ª–µ–µ—Ä
    const container = document.getElementById('courseDetails');
    renderCoursePlayer(container);
}

function updatePlayerActiveModule() {
    const moduleItems = document.querySelectorAll('.player-module-item');
    moduleItems.forEach((item, index) => {
        if (index === currentModuleIndex) {
            item.style.background = 'rgba(0, 89, 255, 0.1)';
            item.style.borderColor = 'var(--primary)';
        } else {
            item.style.background = 'transparent';
            item.style.borderColor = 'transparent';
        }
    });
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function getStatusClass(status) {
    switch(status) {
        case '–ø—Ä–æ–π–¥–µ–Ω': return 'status-completed';
        case '–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ': return 'status-in-progress';
        case '–Ω–∞–∑–Ω–∞—á–µ–Ω': return 'status-upcoming';
        case '–ø—Ä–æ—Å—Ä–æ—á–µ–Ω': return 'status-expired';
        default: return '';
    }
}

function getStatusText(status) {
    switch(status) {
        case '–ø—Ä–æ–π–¥–µ–Ω': return '–ü—Ä–æ–π–¥–µ–Ω';
        case '–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ': return '–í –ø—Ä–æ—Ü–µ—Å—Å–µ';
        case '–Ω–∞–∑–Ω–∞—á–∞–Ω': return '–ù–∞–∑–Ω–∞—á–µ–Ω';
        case '–ø—Ä–æ—Å—Ä–æ—á–µ–Ω': return '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω';
        default: return status;
    }
}

function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('ru-RU');
}

function getCertificateStatus(course) {
    if (course.status === '–ø—Ä–æ–π–¥–µ–Ω') {
        return '–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ–ª—É—á–µ–Ω';
    } else if (course.status === '–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ') {
        return '–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è';
    } else {
        return '–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω';
    }
}
    </script>
</body>
</html>