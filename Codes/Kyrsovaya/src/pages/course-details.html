<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ—Ç–∞–ª–∏ –∫—É—Ä—Å–∞ | –¢–µ—Ö–Ω–æ–õ–∞–π–Ω</title>
    <link rel="stylesheet" href="../style/style.css">
    <link rel="icon" href="../img/MainLogo.svg" type="image/svg+xml">
</head>
<body>
    <div id="app">
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <a href="../index.html"><img src="../img/MainLogo.svg" alt="Logo" class="logo-img">
                    <span class="logo-text">Qualification System</span></a>
                    
                </div>
                <div class="nav-menu" id="navMenu">
                    <a href="../index.html" class="nav-link">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
                    <a href="courses.html" class="nav-link">–ú–æ–∏ –∫—É—Ä—Å—ã</a>
                    <a href="#" class="nav-link">–ü–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è</a>
                    <div class="user-section">
                        <span class="user-name" id="userName">–ü–µ—Ç—Ä–æ–≤ –ê.–í.</span>
                        <button class="btn-logout" id="logoutBtn">–í—ã–π—Ç–∏</button>
                    </div>
                </div>
                <button class="nav-toggle" id="navToggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </nav>

        <main class="main-content">
            <div class="container">
                <a href="courses.html" class="btn-link" style="display: inline-flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                    ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –∫—É—Ä—Å–æ–≤
                </a>
                
                <div id="courseDetails">
                    <!-- –î–µ—Ç–∞–ª–∏ –∫—É—Ä—Å–∞ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    <div class="card text-center">
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫—É—Ä—Å–µ...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="../scripts/auth.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userData = AuthManager.getUserData();
            if (userData && userData.employee) {
                const userNameElement = document.getElementById('userName');
                if (userNameElement) {
                    userNameElement.textContent = userData.employee.name.split(' ')[0] + ' ' + userData.employee.name.split(' ')[1];
                }
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ç–∞–ª–µ–π –∫—É—Ä—Å–∞
            loadCourseDetails();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã—Ö–æ–¥–∞
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('userData');
                    window.location.href = 'login.html';
                });
            }
            
            // –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
            const navToggle = document.getElementById('navToggle');
            const navMenu = document.getElementById('navMenu');
            
            if (navToggle && navMenu) {
                navToggle.addEventListener('click', () => {
                    navMenu.classList.toggle('active');
                });
            }
        });

        const loadCourseDetails = () => {
        const urlParams = new URLSearchParams(window.location.search);
        const courseId = urlParams.get('id');
        const container = document.getElementById('courseDetails');
        
        if (!courseId) {
            this.showCourseNotFound(container, '–ù–µ–≤–µ—Ä–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫—É—Ä—Å–∞');
            return;
        }
        
        const userData = AuthManager.getUserData();
        const course = userData?.courses?.find(c => c.id == courseId);
        
        if (!course) {
            this.showCourseNotFound(container, '–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–π –∫—É—Ä—Å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –∫ –Ω–µ–º—É –¥–æ—Å—Ç—É–ø–∞');
            return;
        }
        
        this.renderCourseDetails(container, course);
    }

    const showCourseNotFound = (container, message) => {
        while (container.firstChild) {
            container.removeChild(container.firstChild);
        }

        const card = document.createElement('div');
        card.className = 'card text-center';
        
        const title = document.createElement('h2');
        title.textContent = '–ö—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω';
        
        const text = document.createElement('p');
        text.textContent = message;
        
        card.appendChild(title);
        card.appendChild(text);
        container.appendChild(card);
    }

    const renderCourseDetails = (container, course) => {
        while (container.firstChild) {
            container.removeChild(container.firstChild);
        }

        const card = document.createElement('div');
        card.className = 'card';

        const header = this.createCourseHeader(course);
        const content = this.createCourseContent(course);

        card.appendChild(header);
        card.appendChild(content);
        container.appendChild(card);
    }

    const createCourseHeader = (course) => {
        const header = document.createElement('div');
        header.className = 'card-header';

        const title = document.createElement('h1');
        title.className = 'card-title';
        title.style.fontSize = '1.5rem';
        title.textContent = course.title;

        const status = document.createElement('div');
        status.className = `course-status ${getStatusClass(course.status)}`;
        status.textContent = getStatusText(course.status);

        header.appendChild(title);
        header.appendChild(status);
        return header;
    }

    const createCourseContent = (course) => {
    const content = document.createElement('div');
    content.className = 'course-content';

    const infoGrid = this.createCourseInfoGrid(course);
    const description = this.createCourseDescription(course);
    const materials = this.createCourseMaterials(course);
    const actions = this.createCourseActions(course);

    content.appendChild(infoGrid);
    content.appendChild(description);
    content.appendChild(materials);
    content.appendChild(actions);
    return content;
}

const createCourseActions = (course) => {
    const actions = document.createElement('div');
    actions.className = 'course-actions';
    actions.style.marginTop = '2rem';
    actions.style.paddingTop = '2rem';
    actions.style.borderTop = '1px solid var(--glass-border)';

    const startBtn = document.createElement('a');
    startBtn.href = `course-player.html?id=${course.id}`;
    startBtn.className = 'btn btn-primary';
    startBtn.style.padding = '1rem 2rem';
    startBtn.style.fontSize = '1.1rem';
    
    if (course.status === '–ø—Ä–æ–π–¥–µ–Ω') {
        startBtn.textContent = '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∫—É—Ä—Å';
        startBtn.classList.add('btn-secondary');
    } else if (course.status === '–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ') {
        startBtn.textContent = '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ';
    } else {
        startBtn.textContent = '–ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ';
    }

    actions.appendChild(startBtn);
    return actions;
}

    const createCourseInfoGrid = (course) => {
        const grid = document.createElement('div');
        grid.style.cssText = 'display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;';

        const items = [
            { title: '–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞', value: formatDate(course.start_date) },
            { title: '–°—Ä–æ–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è', value: formatDate(course.due_date) },
            { title: '–ü—Ä–æ–≥—Ä–µ—Å—Å', value: this.createProgressElement(course.progress) },
            { title: '–°—Ç–∞—Ç—É—Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞', value: getCertificateStatus(course) }
        ];

        items.forEach(item => {
            const infoItem = document.createElement('div');
            infoItem.className = 'info-item';

            const title = document.createElement('h3');
            title.textContent = item.title;

            infoItem.appendChild(title);

            if (typeof item.value === 'string') {
                const value = document.createElement('p');
                value.textContent = item.value;
                infoItem.appendChild(value);
            } else {
                infoItem.appendChild(item.value);
            }

            grid.appendChild(infoItem);
        });

        return grid;
    }

    const createProgressElement = (progress) => {
        const container = document.createElement('div');
        container.className = 'progress-container';

        const progressBar = document.createElement('div');
        progressBar.className = 'progress-bar';

        const progressFill = document.createElement('div');
        progressFill.className = 'progress-fill';
        progressFill.style.width = `${progress}%`;

        const progressLabel = document.createElement('div');
        progressLabel.className = 'progress-label';
        progressLabel.innerHTML = `<span>${progress}% –∑–∞–≤–µ—Ä—à–µ–Ω–æ</span>`;

        progressBar.appendChild(progressFill);
        container.appendChild(progressBar);
        container.appendChild(progressLabel);

        return container;
    }

    const createCourseDescription = (course) => {
        const container = document.createElement('div');
        container.className = 'course-description';
        container.style.marginBottom = '2rem';

        const title = document.createElement('h3');
        title.textContent = '–û–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞';

        const description = document.createElement('p');
        description.textContent = course.description || '–û–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.';

        container.appendChild(title);
        container.appendChild(description);
        return container;
    }

    const createCourseMaterials = (course) => {
        const container = document.createElement('div');
        container.className = 'course-materials';

        const title = document.createElement('h3');
        title.textContent = '–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∫—É—Ä—Å–∞';

        const materialsList = document.createElement('div');
        materialsList.className = 'materials-list';
        materialsList.style.cssText = 'display: grid; gap: 1rem; margin-top: 1rem;';

        const mockMaterials = [
            { type: 'pdf', title: '–£—á–µ–±–Ω–æ–µ –ø–æ—Å–æ–±–∏–µ', url: '#' },
            { type: 'video', title: '–í–≤–æ–¥–Ω–æ–µ –≤–∏–¥–µ–æ', url: '#' },
            { type: 'link', title: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã', url: '#' }
        ];

        mockMaterials.forEach(material => {
            const materialItem = this.createMaterialItem(material);
            materialsList.appendChild(materialItem);
        });

        container.appendChild(title);
        container.appendChild(materialsList);
        return container;
    }

    const createMaterialItem = (material) => {
        const item = document.createElement('div');
        item.className = 'material-item';
        item.style.cssText = 'display: flex; align-items: center; gap: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 4px;';

        const icon = document.createElement('span');
        icon.style.fontSize = '1.25rem';
        icon.textContent = material.type === 'pdf' ? 'üìÑ' : 
                          material.type === 'video' ? 'üé•' : 'üîó';

        const content = document.createElement('div');
        content.style.flex = '1';

        const itemTitle = document.createElement('strong');
        itemTitle.textContent = material.title;

        const itemType = document.createElement('div');
        itemType.style.fontSize = '0.9rem';
        itemType.style.color = '#666';
        itemType.textContent = material.type === 'pdf' ? 'PDF –¥–æ–∫—É–º–µ–Ω—Ç' : 
                              material.type === 'video' ? '–í–∏–¥–µ–æ –º–∞—Ç–µ—Ä–∏–∞–ª' : '–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ—Å—É—Ä—Å';

        const button = document.createElement('a');
        button.href = material.url;
        button.className = 'btn';
        button.target = '_blank';
        button.textContent = material.type === 'pdf' ? '–°–∫–∞—á–∞—Ç—å' : 
                            material.type === 'video' ? '–°–º–æ—Ç—Ä–µ—Ç—å' : '–ü–µ—Ä–µ–π—Ç–∏';

        content.appendChild(itemTitle);
        content.appendChild(itemType);
        item.appendChild(icon);
        item.appendChild(content);
        item.appendChild(button);

        return item;
    }

        const getStatusClass = (status) => {
            switch(status) {
                case '–ø—Ä–æ–π–¥–µ–Ω': return 'status-completed';
                case '–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ': return 'status-in-progress';
                case '–Ω–∞–∑–Ω–∞—á–µ–Ω': return 'status-upcoming';
                case '–ø—Ä–æ—Å—Ä–æ—á–µ–Ω': return 'status-expired';
                default: return '';
            }
        }

        const getStatusText = (status) => {
            switch(status) {
                case '–ø—Ä–æ–π–¥–µ–Ω': return '–ü—Ä–æ–π–¥–µ–Ω';
                case '–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ': return '–í –ø—Ä–æ—Ü–µ—Å—Å–µ';
                case '–Ω–∞–∑–Ω–∞—á–µ–Ω': return '–ù–∞–∑–Ω–∞—á–µ–Ω';
                case '–ø—Ä–æ—Å—Ä–æ—á–µ–Ω': return '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω';
                default: return status;
            }
        }

        const formatDate = (dateString) => {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU');
        }

        const getCertificateStatus(course) {
            if (course.status === '–ø—Ä–æ–π–¥–µ–Ω') {
                return '–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ–ª—É—á–µ–Ω';
            } else if (course.status === '–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ') {
                return '–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è';
            } else {
                return '–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω';
            }
        }

        const generateMaterialsList = (course) => {
            // Mock –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            const mockMaterials = [
                { type: 'pdf', title: '–£—á–µ–±–Ω–æ–µ –ø–æ—Å–æ–±–∏–µ', url: '#' },
                { type: 'video', title: '–í–≤–æ–¥–Ω–æ–µ –≤–∏–¥–µ–æ', url: '#' },
                { type: 'link', title: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã', url: '#' }
            ];
            
            return mockMaterials.map(material => `
                <div class="material-item" style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 4px;">
                    <span style="font-size: 1.25rem;">
                        ${material.type === 'pdf' ? 'üìÑ' : material.type === 'video' ? 'üé•' : 'üîó'}
                    </span>
                    <div style="flex: 1;">
                        <strong>${material.title}</strong>
                        <div style="font-size: 0.9rem; color: #666;">
                            ${material.type === 'pdf' ? 'PDF –¥–æ–∫—É–º–µ–Ω—Ç' : material.type === 'video' ? '–í–∏–¥–µ–æ –º–∞—Ç–µ—Ä–∏–∞–ª' : '–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ—Å—É—Ä—Å'}
                        </div>
                    </div>
                    <a href="${material.url}" class="btn" target="_blank">
                        ${material.type === 'pdf' ? '–°–∫–∞—á–∞—Ç—å' : material.type === 'video' ? '–°–º–æ—Ç—Ä–µ—Ç—å' : '–ü–µ—Ä–µ–π—Ç–∏'}
                    </a>
                </div>
            `).join('');
        }
    </script>
</body>
</html>